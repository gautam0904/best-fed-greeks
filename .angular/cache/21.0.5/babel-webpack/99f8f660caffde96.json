{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/rutviks/OneDrive - infopercept.com/Desktop/New folder/best-fed-greeks-app-full-source/best-fed-greeks-app-full-source/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Router } from '@angular/router';\nimport { NavController } from '@ionic/angular';\nimport { HttpService } from '../../services/common/http.service';\nimport { MessageService } from '../../services/common/message.service';\nimport { BFGMealPlanService } from '../../services/bfg-meal-plan.service';\nimport moment from 'moment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ionic/angular\";\nimport * as i2 from \"../../services/bfg-meal-plan.service\";\nimport * as i3 from \"../../services/common/http.service\";\nimport * as i4 from \"../../services/common/message.service\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/forms\";\nimport * as i8 from \"../../components/meal-details/meal-details.component\";\nimport * as i9 from \"../../components/datepicker/li-ionic4-datepicker.directive\";\nfunction MealRatingPage_ion_item_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-item\")(1, \"ion-label\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"ion-radio\", 15);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const mealType_r1 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(mealType_r1);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"value\", i0.ɵɵinterpolate(mealType_r1));\n  }\n}\nfunction MealRatingPage_app_meal_details_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-meal-details\", 16);\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"details\", ctx_r1.menuDayDetails)(\"day\", ctx_r1.day)(\"drilldown\", false);\n  }\n}\nexport let MealRatingPage = /*#__PURE__*/(() => {\n  class MealRatingPage {\n    nav;\n    mealPlans;\n    http;\n    msg;\n    router;\n    data = {\n      date: '',\n      feedback: '',\n      rating: ''\n    };\n    day = '';\n    mealTypes = [];\n    mealType = '';\n    menuDayDetails = [];\n    menuDayDetailsLoaded = false;\n    hasMealServiceForDay = false;\n    datePickerObj = {\n      dateFormat: 'MM/DD/YYYY',\n      mondayFirst: true,\n      closeOnSelect: true,\n      titleLabel: 'MM/DD/YYYY'\n    };\n    _mealTypeFromExtra = '';\n    _state = {};\n    constructor(nav, mealPlans, http, msg, router) {\n      this.nav = nav;\n      this.mealPlans = mealPlans;\n      this.http = http;\n      this.msg = msg;\n      this.router = router;\n      console.log(this.router.getCurrentNavigation());\n      let extras = this.router.getCurrentNavigation().extras;\n      this._state = extras && extras.state ? extras.state : {};\n    }\n    ionViewDidEnter() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        let state = _this._state;\n        _this._mealTypeFromExtra = state && state.mealType ? state.mealType.charAt(0).toUpperCase() + state.mealType.slice(1) : '';\n        _this.data.date = state && state.date ? moment(state.date).format('MM/DD/YYYY') : moment().format('MM/DD/YYYY');\n        _this.data.rating = '';\n        _this.data.feedback = '';\n      })();\n    }\n    mealDateChanged() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        yield _this2.msg.showLoader('Loading meal types, please wait...');\n        _this2.mealType = '';\n        _this2.day = moment(_this2.data.date).format('dddd');\n        _this2.mealPlans.loadAvailableMealTypes(moment(_this2.data.date).format('YYYY-MM-DD')).subscribe(/*#__PURE__*/function () {\n          var _ref = _asyncToGenerator(function* (mealTypes) {\n            yield _this2.msg.hideLoader();\n            _this2.mealTypes = mealTypes && mealTypes.length ? mealTypes : mealTypes;\n            if (_this2._mealTypeFromExtra) {\n              _this2.mealTypes = _this2.mealTypes.filter(mealType => {\n                return mealType == _this2._mealTypeFromExtra;\n              });\n              _this2.mealType = _this2._mealTypeFromExtra;\n              _this2._mealTypeFromExtra;\n            } else if (_this2.mealTypes.length > 0) {\n              _this2.mealType = _this2.mealTypes[0];\n            }\n          });\n          return function (_x) {\n            return _ref.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n    mealTypeChanged() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this3.data.date || !_this3.mealType) return;\n        yield _this3.msg.showLoader('Loading meal for that day, please wait...');\n        _this3.http.post('bfg/meals/load-day-meal', {\n          date: moment(_this3.data.date).format('YYYY-MM-DD'),\n          meal_type: _this3.mealType\n        }).subscribe(/*#__PURE__*/function () {\n          var _ref2 = _asyncToGenerator(function* (response) {\n            yield _this3.msg.hideLoader();\n            if (response.error || !response.success) {\n              yield _this3.msg.showToast('Error', response.message ? response.message : 'The meal for this day could not be loaded. Please try another day.', 10000);\n              return;\n            }\n            _this3.menuDayDetails = response.menu_day_details;\n            _this3.hasMealServiceForDay = response.has_meal_service;\n            _this3.menuDayDetailsLoaded = true;\n          });\n          return function (_x2) {\n            return _ref2.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n    save() {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this4.data.rating) {\n          _this4.msg.showToast('Error', 'Please select a rating');\n          return;\n        }\n        if (!_this4.hasMealServiceForDay) {\n          _this4.msg.showToast('Error', 'No meal service for that day so cannot rate meal');\n          return;\n        }\n        if (!_this4.data.feedback) {\n          _this4.msg.showToast('Error', 'Please provide feedback');\n          return;\n        }\n        yield _this4.msg.showLoader('Saving meal rating, please wait...');\n        _this4.http.post('bfg/ratings/save-meal-rating', {\n          meal_type: _this4.mealType,\n          meal_date: moment(_this4.data.date).format('YYYY-MM-DD'),\n          feedback: _this4.data.feedback,\n          rating: _this4.data.rating\n        }).subscribe(/*#__PURE__*/function () {\n          var _ref3 = _asyncToGenerator(function* (response) {\n            yield _this4.msg.hideLoader();\n            if (response.error) {\n              yield _this4.msg.showToast('Error', response.message ? response.message : 'There was an error saving your meal rating. Please contact technical support if this persists.');\n              return;\n            }\n            yield _this4.msg.showToast('Success', 'Thanks for rating your meal! We value your feedback.');\n            _this4.nav.pop();\n          });\n          return function (_x3) {\n            return _ref3.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n    static ɵfac = function MealRatingPage_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || MealRatingPage)(i0.ɵɵdirectiveInject(i1.NavController), i0.ɵɵdirectiveInject(i2.BFGMealPlanService), i0.ɵɵdirectiveInject(i3.HttpService), i0.ɵɵdirectiveInject(i4.MessageService), i0.ɵɵdirectiveInject(i5.Router));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: MealRatingPage,\n      selectors: [[\"app-meal-rating\"]],\n      standalone: false,\n      decls: 39,\n      vars: 6,\n      consts: [[\"slot\", \"start\"], [\"defaultHref\", \"/ratings\"], [1, \"wrap-text\"], [\"no-padding\", \"\"], [\"size\", \"12\", \"size-lg\", \"6\", \"offset-lg\", \"3\", \"padding\", \"\"], [\"position\", \"floating\"], [\"name\", \"date\", 3, \"ngModelChange\", \"ionChange\", \"ngModel\", \"liIonic4Datepicker\"], [\"name\", \"mealType\", 3, \"ngModelChange\", \"ionChange\", \"ngModel\"], [4, \"ngFor\", \"ngForOf\"], [\"size\", \"12\", \"padding\", \"\"], [3, \"details\", \"day\", \"date\", \"drilldown\", 4, \"ngIf\"], [\"size\", \"12\", \"size-lg\", \"6\", \"offset-lg\", \"3\"], [\"position\", \"stacked\", \"color\", \"secondary\"], [\"name\", \"feedback\", \"rows\", \"6\", \"cols\", \"20\", \"placeholder\", \"Please leave us a comment...\", 3, \"ngModelChange\", \"ngModel\"], [\"bfg-btm-btn\", \"\", \"expand\", \"full\", \"size\", \"large\", \"color\", \"primary\", 3, \"click\"], [\"slot\", \"end\", 3, \"value\"], [3, \"details\", \"day\", \"date\", \"drilldown\"]],\n      template: function MealRatingPage_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\")(2, \"ion-buttons\", 0);\n          i0.ɵɵelement(3, \"ion-back-button\", 1);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(4, \"ion-title\")(5, \"span\", 2);\n          i0.ɵɵtext(6, \"MEAL RATING\");\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(7, \"ion-content\")(8, \"ion-grid\", 3)(9, \"ion-row\")(10, \"ion-col\", 4)(11, \"form\")(12, \"h3\");\n          i0.ɵɵtext(13, \"Rating Date\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(14, \"ion-item\")(15, \"ion-label\", 5);\n          i0.ɵɵtext(16, \"MM/DD/YYYY\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(17, \"ion-input\", 6);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function MealRatingPage_Template_ion_input_ngModelChange_17_listener($event) {\n            i0.ɵɵtwoWayBindingSet(ctx.data.date, $event) || (ctx.data.date = $event);\n            return $event;\n          });\n          i0.ɵɵlistener(\"ionChange\", function MealRatingPage_Template_ion_input_ionChange_17_listener() {\n            return ctx.mealDateChanged();\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(18, \"h3\");\n          i0.ɵɵtext(19, \"Meal Type\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(20, \"ion-list\")(21, \"ion-radio-group\", 7);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function MealRatingPage_Template_ion_radio_group_ngModelChange_21_listener($event) {\n            i0.ɵɵtwoWayBindingSet(ctx.mealType, $event) || (ctx.mealType = $event);\n            return $event;\n          });\n          i0.ɵɵlistener(\"ionChange\", function MealRatingPage_Template_ion_radio_group_ionChange_21_listener() {\n            return ctx.mealTypeChanged();\n          });\n          i0.ɵɵtemplate(22, MealRatingPage_ion_item_22_Template, 4, 3, \"ion-item\", 8);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(23, \"ion-col\", 9);\n          i0.ɵɵtemplate(24, MealRatingPage_app_meal_details_24_Template, 1, 3, \"app-meal-details\", 10);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(25, \"ion-col\", 4)(26, \"h3\");\n          i0.ɵɵtext(27, \"Meal Rating\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(28, \"ion-col\", 11)(29, \"form\")(30, \"ion-list\")(31, \"ion-item\")(32, \"ion-label\", 12);\n          i0.ɵɵtext(33, \"Comment\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(34, \"ion-textarea\", 13);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function MealRatingPage_Template_ion_textarea_ngModelChange_34_listener($event) {\n            i0.ɵɵtwoWayBindingSet(ctx.data.feedback, $event) || (ctx.data.feedback = $event);\n            return $event;\n          });\n          i0.ɵɵelementEnd()()()()()()()();\n          i0.ɵɵelementStart(35, \"ion-footer\")(36, \"ion-button\", 14);\n          i0.ɵɵlistener(\"click\", function MealRatingPage_Template_ion_button_click_36_listener() {\n            return ctx.save();\n          });\n          i0.ɵɵelementStart(37, \"strong\");\n          i0.ɵɵtext(38, \"Save\");\n          i0.ɵɵelementEnd()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(17);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.data.date);\n          i0.ɵɵproperty(\"liIonic4Datepicker\", ctx.datePickerObj);\n          i0.ɵɵadvance(4);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.mealType);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngForOf\", ctx.mealTypes);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngIf\", ctx.menuDayDetailsLoaded);\n          i0.ɵɵadvance(10);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.data.feedback);\n        }\n      },\n      dependencies: [i6.NgForOf, i6.NgIf, i7.ɵNgNoValidate, i7.NgControlStatus, i7.NgControlStatusGroup, i7.NgModel, i7.NgForm, i1.IonButton, i1.IonButtons, i1.IonCol, i1.IonContent, i1.IonFooter, i1.IonGrid, i1.IonHeader, i1.IonInput, i1.IonItem, i1.IonLabel, i1.IonList, i1.IonRadio, i1.IonRadioGroup, i1.IonRow, i1.IonTextarea, i1.IonTitle, i1.IonToolbar, i1.SelectValueAccessor, i1.TextValueAccessor, i1.IonBackButton, i8.MealDetailsComponent, i9.LiIonic4DatepickerDirective],\n      encapsulation: 2\n    });\n  }\n  return MealRatingPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}