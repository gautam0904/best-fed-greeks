{"ast":null,"code":"import _asyncToGenerator from \"/Users/malaviyagautam/Code/JS/MEAN/Ionic/ionic-project-master/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { HttpService } from '../../services/common/http.service';\nimport { MessageService } from '../../services/common/message.service';\nimport { BFGUserService } from '../../services/bfg-user.service';\nimport moment from 'moment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/bfg-user.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../../services/common/http.service\";\nimport * as i4 from \"../../services/common/message.service\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/forms\";\nimport * as i7 from \"@ionic/angular\";\nimport * as i8 from \"@ng-select/ng-select\";\nfunction MenuEditPage_ion_content_8_ng_container_5_ng_container_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"h2\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"ng-select\", 8);\n    i0.ɵɵlistener(\"add\", function MenuEditPage_ion_content_8_ng_container_5_ng_container_4_Template_ng_select_add_3_listener($event) {\n      const mealType_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const menuDay_r3 = i0.ɵɵnextContext().$implicit;\n      const ctx_r3 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r3.addMenuItem(menuDay_r3, mealType_r2, $event));\n    })(\"remove\", function MenuEditPage_ion_content_8_ng_container_5_ng_container_4_Template_ng_select_remove_3_listener($event) {\n      const mealType_r2 = i0.ɵɵrestoreView(_r1).$implicit;\n      const menuDay_r3 = i0.ɵɵnextContext().$implicit;\n      const ctx_r3 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r3.removeMenuItem(menuDay_r3, mealType_r2, $event));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const mealType_r2 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(mealType_r2.display);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"items\", ctx_r3.recipes)(\"groupBy\", \"category\")(\"multiple\", true)(\"ngModel\", mealType_r2.recipeIds)(\"virtualScroll\", true)(\"addTag\", true)(\"clearable\", false)(\"clearOnBackspace\", false);\n  }\n}\nfunction MenuEditPage_ion_content_8_ng_container_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"ion-list-header\")(2, \"h1\", 1);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(4, MenuEditPage_ion_content_8_ng_container_5_ng_container_4_Template, 4, 9, \"ng-container\", 7);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const menuDay_r3 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate2(\"\", menuDay_r3.day, \" - \", menuDay_r3.dateDisplay);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", menuDay_r3.mealTypes);\n  }\n}\nfunction MenuEditPage_ion_content_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-content\")(1, \"ion-grid\", 3)(2, \"ion-row\", 4)(3, \"ion-col\", 5)(4, \"ion-list\", 6);\n    i0.ɵɵtemplate(5, MenuEditPage_ion_content_8_ng_container_5_Template, 5, 3, \"ng-container\", 7);\n    i0.ɵɵelementEnd()()()()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.menuPlanAvailability);\n  }\n}\nexport let MenuEditPage = /*#__PURE__*/(() => {\n  class MenuEditPage {\n    bfgUser;\n    router;\n    route;\n    http;\n    msg;\n    loaded = false;\n    recipes = [];\n    _mealPlanAvailability = [];\n    _houseId = 0;\n    _mondayDate = '';\n    _dateStart = '';\n    _dateEnd = '';\n    _dateRangeDisplay = '';\n    constructor(bfgUser, router, route, http, msg) {\n      this.bfgUser = bfgUser;\n      this.router = router;\n      this.route = route;\n      this.http = http;\n      this.msg = msg;\n    }\n    get dateRangeDisplay() {\n      return this._dateRangeDisplay;\n    }\n    get menuPlanAvailability() {\n      return this._mealPlanAvailability;\n    }\n    ngOnInit() {\n      this.route.params.subscribe(params => {\n        this._houseId = parseInt(params['houseId']);\n        this._mondayDate = params['date'];\n        this._dateStart = moment(this._mondayDate).format('MM/DD/YYYY');\n        this._dateEnd = moment(this._dateStart).add('6', 'days').format('MM/DD/YYYY');\n        this._dateRangeDisplay = this._dateStart + ' - ' + this._dateEnd;\n      });\n    }\n    ionViewDidEnter() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        if (!_this.bfgUser.isSuperChef() && !_this.bfgUser.isChef()) {\n          _this.router.navigateByUrl('/login');\n          _this.msg.showToast('Error', 'Oops. We had trouble loading the dashboard.');\n          return;\n        }\n        if (_this._houseId) {\n          _this.loadMenuEdit(_this._houseId);\n        }\n      })();\n    }\n    addMenuItem(menuDay, mealType, $record) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        // Already saved recipe. Go ahead an save the menu dish\n        if ($record.id) {\n          _this2.saveMenuDish(menuDay, mealType, $record);\n        } else if ($record.name) {\n          yield _this2.msg.showLoader('Saving, please wait...');\n          _this2.http.post('bfg/menu-builder/save-recipe', {\n            bfg_house_id: _this2._houseId,\n            name: $record.name,\n            mealType: mealType.display\n          }).subscribe(/*#__PURE__*/function () {\n            var _ref = _asyncToGenerator(function* (response) {\n              $record.id = response.id;\n              if ($record.id) {\n                mealType.recipeIds.push($record.id);\n                _this2.recipes = [].concat(_this2.recipes, [{\n                  \"name\": $record.name,\n                  \"id\": response.recipe_id\n                }]);\n                _this2.saveMenuDish(menuDay, mealType, $record);\n              } else {\n                yield _this2.msg.hideLoader();\n              }\n            });\n            return function (_x) {\n              return _ref.apply(this, arguments);\n            };\n          }());\n          console.log(menuDay, mealType, $record);\n        }\n      })();\n    }\n    removeMenuItem(menuDay, mealType, $record) {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        yield _this3.msg.showLoader('Removing menu dish, please wait...');\n        _this3.http.post('bfg/menu-builder/remove-menu-dish', {\n          bfg_house_id: _this3._houseId,\n          date: menuDay.date,\n          meal_type: mealType.display,\n          recipe_id: $record.value.id\n        }).subscribe(/*#__PURE__*/function () {\n          var _ref2 = _asyncToGenerator(function* (response) {\n            yield _this3.msg.hideLoader();\n          });\n          return function (_x2) {\n            return _ref2.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n    saveMenuDish(menuDay, mealType, $record) {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        yield _this4.msg.showLoader('Saving, please wait...');\n        _this4.http.post('bfg/menu-builder/save-menu-dish', {\n          bfg_house_id: _this4._houseId,\n          start_date: menuDay.date,\n          meal_type: mealType.display,\n          recipe_id: $record.id\n        }).subscribe(/*#__PURE__*/function () {\n          var _ref3 = _asyncToGenerator(function* (response) {\n            yield _this4.msg.hideLoader();\n          });\n          return function (_x3) {\n            return _ref3.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n    back() {\n      this.router.navigate(['/house-menu-builder/summary/', this._houseId, this._mondayDate]);\n    }\n    loadMenuEdit(houseId) {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        yield _this5.msg.showLoader();\n        _this5._houseId = houseId;\n        _this5.bfgUser.initializeHouses().subscribe(/*#__PURE__*/function () {\n          var _ref4 = _asyncToGenerator(function* (myResponse) {\n            _this5.bfgUser.switchToHouse(houseId);\n            _this5.http.post('bfg/menu-builder/load-menu', {\n              bfg_house_id: houseId,\n              monday_of_week: _this5._mondayDate\n            }).subscribe(/*#__PURE__*/function () {\n              var _ref5 = _asyncToGenerator(function* (response) {\n                yield _this5.msg.hideLoader();\n                let mealPlanAvailability = [];\n                let serviceAvailability = response.meal_plan_service_availability;\n                let menuDishes = response.menu_dishes;\n                let days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];\n                let recipesByDayType = [];\n                for (let menuDish of menuDishes) {\n                  let mealType = menuDish.mealType;\n                  let day = moment(menuDish.start).format('dddd').toLowerCase();\n                  if (!recipesByDayType[day]) {\n                    recipesByDayType[day] = {};\n                  }\n                  if (!recipesByDayType[day][mealType]) {\n                    recipesByDayType[day][mealType] = [];\n                  }\n                  recipesByDayType[day][mealType].push(menuDish.recipe_id);\n                }\n                let currentDate = moment(_this5._mondayDate);\n                _this5.recipes = response.recipes;\n                let currentIteration = 0;\n                for (let day of days) {\n                  if (currentIteration > 0) {\n                    currentDate = currentDate.add(1, 'days');\n                  }\n                  if (serviceAvailability[day]) {\n                    let mealTypes = [];\n                    if (serviceAvailability[day]['Breakfast'] && serviceAvailability[day]['Breakfast']['enabled']) {\n                      let recipeIds = recipesByDayType[day] && recipesByDayType[day]['Breakfast'] ? recipesByDayType[day]['Breakfast'] : [];\n                      mealTypes.push({\n                        recipeIds: recipeIds,\n                        display: 'Breakfast'\n                      });\n                    }\n                    if (serviceAvailability[day]['Brunch'] && serviceAvailability[day]['Brunch']['enabled']) {\n                      let recipeIds = recipesByDayType[day] && recipesByDayType[day]['Brunch'] ? recipesByDayType[day]['Brunch'] : [];\n                      mealTypes.push({\n                        recipeIds: recipeIds,\n                        display: 'Brunch'\n                      });\n                    }\n                    if (serviceAvailability[day]['Lunch'] && serviceAvailability[day]['Lunch']['enabled']) {\n                      let recipeIds = recipesByDayType[day] && recipesByDayType[day]['Lunch'] ? recipesByDayType[day]['Lunch'] : [];\n                      mealTypes.push({\n                        recipeIds: recipeIds,\n                        display: 'Lunch'\n                      });\n                    }\n                    if (serviceAvailability[day]['Dinner'] && serviceAvailability[day]['Dinner']['enabled']) {\n                      let recipeIds = recipesByDayType[day] && recipesByDayType[day]['Dinner'] ? recipesByDayType[day]['Dinner'] : [];\n                      mealTypes.push({\n                        recipeIds: recipeIds,\n                        display: 'Dinner'\n                      });\n                    }\n                    if (mealTypes.length > 0) {\n                      mealPlanAvailability.push({\n                        day: day.substring(0, 1).toUpperCase() + day.substring(1),\n                        date: currentDate.format('YYYY-MM-DD'),\n                        dateDisplay: currentDate.format('MM/DD/YYYY'),\n                        mealTypes: mealTypes\n                      });\n                    }\n                  }\n                  currentIteration++;\n                }\n                _this5._mealPlanAvailability = mealPlanAvailability;\n                _this5.loaded = true;\n              });\n              return function (_x5) {\n                return _ref5.apply(this, arguments);\n              };\n            }());\n          });\n          return function (_x4) {\n            return _ref4.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n    static ɵfac = function MenuEditPage_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || MenuEditPage)(i0.ɵɵdirectiveInject(i1.BFGUserService), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i3.HttpService), i0.ɵɵdirectiveInject(i4.MessageService));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: MenuEditPage,\n      selectors: [[\"app-house-menu-edit\"]],\n      standalone: false,\n      decls: 10,\n      vars: 2,\n      consts: [[\"name\", \"arrow-back\", 2, \"font-size\", \"2em\", 3, \"click\"], [1, \"wrap-text\"], [4, \"ngIf\"], [\"no-padding\", \"\", 2, \"height\", \"100%\"], [2, \"height\", \"100%\"], [\"size\", \"12\", 1, \"profile-top\", 2, \"height\", \"100%\"], [\"lines\", \"full\", \"no-padding\", \"\", 1, \"meal-day-list\"], [4, \"ngFor\", \"ngForOf\"], [\"bindValue\", \"id\", \"bindLabel\", \"name\", 3, \"add\", \"remove\", \"items\", \"groupBy\", \"multiple\", \"ngModel\", \"virtualScroll\", \"addTag\", \"clearable\", \"clearOnBackspace\"]],\n      template: function MenuEditPage_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\")(2, \"ion-icon\", 0);\n          i0.ɵɵlistener(\"click\", function MenuEditPage_Template_ion_icon_click_2_listener() {\n            return ctx.back();\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(3, \"ion-title\")(4, \"span\", 1);\n          i0.ɵɵtext(5, \"Menu Edit\");\n          i0.ɵɵelement(6, \"br\");\n          i0.ɵɵtext(7);\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵtemplate(8, MenuEditPage_ion_content_8_Template, 6, 1, \"ion-content\", 2);\n          i0.ɵɵelement(9, \"ion-footer\");\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(7);\n          i0.ɵɵtextInterpolate(ctx.dateRangeDisplay);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.loaded);\n        }\n      },\n      dependencies: [i5.NgForOf, i5.NgIf, i6.NgControlStatus, i6.NgModel, i7.IonCol, i7.IonContent, i7.IonFooter, i7.IonGrid, i7.IonHeader, i7.IonIcon, i7.IonList, i7.IonListHeader, i7.IonRow, i7.IonTitle, i7.IonToolbar, i8.NgSelectComponent],\n      styles: [\"ion-list-header[_ngcontent-%COMP%]{--background: var(--ion-color-primary);--color: white}ion-item[_ngcontent-%COMP%]{--background: #EDEDED}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{padding:1rem}\"]\n    });\n  }\n  return MenuEditPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}