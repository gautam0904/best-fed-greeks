{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/rutviks/OneDrive - infopercept.com/Desktop/New folder/best-fed-greeks-app-full-source/best-fed-greeks-app-full-source/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { HttpClient } from '@angular/common/http';\nimport { environment } from '../../../environments/environment';\nimport { Observable, throwError } from 'rxjs';\nimport { catchError, timeout } from 'rxjs/operators';\nimport { NetworkService } from './network.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./network.service\";\nexport let HttpService = /*#__PURE__*/(() => {\n  class HttpService {\n    http;\n    networkService;\n    apiUrl = environment.apiUrl;\n    constructor(http, networkService) {\n      this.http = http;\n      this.networkService = networkService;\n      // Log the API URL being used\n      console.log('HTTP Service initialized with API URL:', this.apiUrl);\n    }\n    getFullUrl(endPoint) {\n      const prefix = environment.apiPrefix || '';\n      const fullUrl = this.apiUrl + '/' + prefix + endPoint;\n      console.log('Making direct API request to:', fullUrl);\n      return fullUrl;\n    }\n    retryWithoutCorsProxy(_x, _x2, _x3) {\n      var _this = this;\n      return _asyncToGenerator(function* (endPoint, params, options, isPost = true) {\n        // If CORS proxy failed, try without it\n        if (environment.useCorsProxy) {\n          console.log('CORS proxy failed, retrying without proxy...');\n          const directUrl = _this.apiUrl + '/' + endPoint;\n          const directOptions = {\n            ...options,\n            headers: {\n              'Content-Type': 'application/json',\n              'Accept': 'application/json',\n              ...options.headers\n            }\n          };\n          return new Promise((resolve, reject) => {\n            const request = isPost ? _this.http.post(directUrl, params, directOptions) : _this.http.get(directUrl, directOptions);\n            request.pipe(timeout(30000), catchError(_this.handleError.bind(_this))).subscribe({\n              next: response => {\n                console.log('Direct request successful:', directUrl);\n                resolve(response);\n              },\n              error: error => {\n                console.error('Direct request also failed:', error);\n                reject(error);\n              }\n            });\n          });\n        }\n        throw new Error('CORS proxy not available and direct request failed');\n      }).apply(this, arguments);\n    }\n    post(endPoint, params, options = {}) {\n      // Check network connectivity first\n      if (!this.networkService.isNetworkAvailable()) {\n        return throwError(() => new Error(this.networkService.getNetworkErrorMessage()));\n      }\n      const fullUrl = this.getFullUrl(endPoint);\n      console.log('Making POST request to:', fullUrl);\n      // Add CORS headers to help with cross-origin requests\n      const corsOptions = {\n        ...options,\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json',\n          'Access-Control-Allow-Origin': '*',\n          'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\n          'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n          ...options.headers\n        }\n      };\n      return new Observable(observer => {\n        try {\n          this.http.post(fullUrl, params, corsOptions).pipe(timeout(30000),\n          // 30 second timeout\n          catchError(this.handleError.bind(this))).subscribe({\n            next: response => {\n              try {\n                console.log('POST response from:', fullUrl, response);\n                observer.next(response);\n                observer.complete();\n              } catch (error) {\n                console.error('Error in post response handler:', error);\n                observer.error(error);\n              }\n            },\n            error: error => {\n              console.error('HTTP Error for:', fullUrl, error);\n              observer.error(error);\n            }\n          });\n        } catch (error) {\n          console.error('Error in post method:', error);\n          observer.error(error);\n        }\n      });\n    }\n    get(endPoint, options = {}) {\n      // Check network connectivity first\n      if (!this.networkService.isNetworkAvailable()) {\n        return throwError(() => new Error(this.networkService.getNetworkErrorMessage()));\n      }\n      const fullUrl = this.getFullUrl(endPoint);\n      console.log('Making GET request to:', fullUrl);\n      // Add CORS headers to help with cross-origin requests\n      const corsOptions = {\n        ...options,\n        headers: {\n          'Accept': 'application/json',\n          'Access-Control-Allow-Origin': '*',\n          'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\n          'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n          ...options.headers\n        }\n      };\n      return new Observable(observer => {\n        try {\n          this.http.get(fullUrl, corsOptions).pipe(timeout(30000),\n          // 30 second timeout\n          catchError(this.handleError.bind(this))).subscribe({\n            next: response => {\n              try {\n                console.log('GET response from:', fullUrl, response);\n                observer.next(response);\n                observer.complete();\n              } catch (error) {\n                console.error('Error in get response handler:', error);\n                observer.error(error);\n              }\n            },\n            error: error => {\n              console.error('HTTP Error for:', fullUrl, error);\n              observer.error(error);\n            }\n          });\n        } catch (error) {\n          console.error('Error in get method:', error);\n          observer.error(error);\n        }\n      });\n    }\n    handleError(error) {\n      let errorMessage = 'An error occurred';\n      try {\n        if (error.error instanceof ErrorEvent) {\n          // Client-side error\n          errorMessage = `Client Error: ${error.error.message}`;\n        } else {\n          // Server-side error\n          if (error.status === 0) {\n            // This is likely a network connectivity issue\n            if (error.message && error.message.includes('CORS')) {\n              errorMessage = 'CORS Error: The server is not allowing cross-origin requests. Please contact the server administrator to enable CORS for this app.';\n            } else if (error.message && error.message.includes('timeout')) {\n              errorMessage = 'Network Timeout: The request took too long to complete. Please check your internet connection.';\n            } else if (error.message && error.message.includes('Unknown Error')) {\n              errorMessage = 'Network Error: Unable to connect to the server. Please check:\\n1. Your internet connection\\n2. The server is running\\n3. The API URL is correct';\n            } else {\n              errorMessage = this.networkService.getNetworkErrorMessage();\n            }\n          } else if (error.status === 403) {\n            errorMessage = 'Access Forbidden: The server is blocking this request. This may be due to CORS policy restrictions.';\n          } else if (error.status === 404) {\n            errorMessage = 'API Endpoint Not Found: The requested API endpoint does not exist.';\n          } else if (error.status === 500) {\n            errorMessage = 'Server Error: The server encountered an internal error. Please try again later.';\n          } else if (error.status === 401) {\n            errorMessage = 'Unauthorized: Please check your login credentials.';\n          } else {\n            errorMessage = `Server Error: ${error.status} - ${error.message}`;\n          }\n        }\n        console.error('HTTP Error Details:', {\n          status: error.status,\n          statusText: error.statusText,\n          url: error.url,\n          message: errorMessage,\n          error: error.error,\n          corsError: error.message && error.message.includes('CORS'),\n          networkError: error.status === 0,\n          timestamp: new Date().toISOString()\n        });\n      } catch (error) {\n        console.error('Error in handleError method:', error);\n        errorMessage = 'An unexpected error occurred';\n      }\n      return throwError(() => new Error(errorMessage));\n    }\n    static ɵfac = function HttpService_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || HttpService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.NetworkService));\n    };\n    static ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: HttpService,\n      factory: HttpService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n  return HttpService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}