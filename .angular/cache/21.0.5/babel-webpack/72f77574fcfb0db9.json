{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/rutviks/OneDrive - infopercept.com/Desktop/New folder/best-fed-greeks-app-full-source/best-fed-greeks-app-full-source/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Platform } from '@ionic/angular';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ionic/angular\";\nlet PushNotifications = null;\nlet FCM = null;\nexport let BFGPushNotificationService = /*#__PURE__*/(() => {\n  class BFGPushNotificationService {\n    platform;\n    isInitialized = false;\n    constructor(platform) {\n      this.platform = platform;\n      this.initializePlugins();\n    }\n    initializePlugins() {\n      return _asyncToGenerator(function* () {\n        try {\n          // Try to import Capacitor PushNotifications plugin\n          try {\n            const {\n              Plugins\n            } = yield import('@capacitor/core');\n            if (Plugins && Plugins.PushNotifications) {\n              PushNotifications = Plugins.PushNotifications;\n            }\n          } catch (error) {\n            console.warn('Could not import Capacitor PushNotifications plugin:', error);\n          }\n          // Try to import FCM plugin\n          try {\n            const fcmModule = yield import('@capacitor-community/fcm');\n            if (fcmModule && fcmModule.FCM) {\n              FCM = fcmModule.FCM;\n            }\n          } catch (error) {\n            console.warn('Could not import FCM plugin:', error);\n          }\n        } catch (error) {\n          console.warn('Error initializing push notification plugins:', error);\n        }\n      })();\n    }\n    init() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        try {\n          if (_this.isInitialized) {\n            return true;\n          }\n          yield _this.platform.ready();\n          if (!PushNotifications) {\n            console.warn('PushNotifications plugin not available');\n            return false;\n          }\n          // Request permission\n          const permissionState = yield PushNotifications.requestPermissions();\n          if (permissionState.receive !== 'granted') {\n            console.warn('Push notification permission not granted');\n            return false;\n          }\n          // Register with Apple / Google to receive push via APNS/FCM\n          yield PushNotifications.register();\n          // Set up listeners\n          _this.setupListeners();\n          _this.isInitialized = true;\n          return true;\n        } catch (error) {\n          console.error('Error initializing push notifications:', error);\n          return false;\n        }\n      })();\n    }\n    setupListeners() {\n      try {\n        if (!PushNotifications) return;\n        // On successful registration\n        PushNotifications.addListener('registration', token => {\n          console.log('Push registration success, token:', token.value);\n          this.storeToken(token.value);\n        });\n        // On registration error\n        PushNotifications.addListener('registrationError', error => {\n          console.error('Error on registration:', error);\n        });\n        // On push received\n        PushNotifications.addListener('pushNotificationReceived', notification => {\n          console.log('Push received:', notification);\n        });\n        // On push clicked\n        PushNotifications.addListener('pushNotificationActionPerformed', notification => {\n          console.log('Push action performed:', notification);\n        });\n      } catch (error) {\n        console.error('Error setting up push listeners:', error);\n      }\n    }\n    storeToken(token) {\n      try {\n        const config = this.getStoredConfig();\n        config.token = token;\n        localStorage.setItem('push-notification-config', JSON.stringify(config));\n      } catch (error) {\n        console.error('Error storing push token:', error);\n      }\n    }\n    getStoredConfig() {\n      try {\n        const stored = localStorage.getItem('push-notification-config');\n        return stored ? JSON.parse(stored) : {};\n      } catch (error) {\n        console.error('Error getting stored config:', error);\n        return {};\n      }\n    }\n    subscribeToTopic(topic) {\n      return _asyncToGenerator(function* () {\n        try {\n          if (!FCM) {\n            console.warn('FCM plugin not available');\n            return false;\n          }\n          yield FCM.subscribeTo({\n            topic\n          });\n          console.log('Subscribed to topic:', topic);\n          return true;\n        } catch (error) {\n          console.error('Error subscribing to topic:', error);\n          return false;\n        }\n      })();\n    }\n    unsubscribeFromTopic(topic) {\n      return _asyncToGenerator(function* () {\n        try {\n          if (!FCM) {\n            console.warn('FCM plugin not available');\n            return false;\n          }\n          yield FCM.unsubscribeFrom({\n            topic\n          });\n          console.log('Unsubscribed from topic:', topic);\n          return true;\n        } catch (error) {\n          console.error('Error unsubscribing from topic:', error);\n          return false;\n        }\n      })();\n    }\n    clear() {\n      try {\n        this.isInitialized = false;\n        localStorage.removeItem('push-notification-config');\n      } catch (error) {\n        console.error('Error clearing push notifications:', error);\n      }\n    }\n    // Add missing methods that other parts of the app expect\n    isSubscribedToChat(inHouseId) {\n      try {\n        const topic = 'house.' + inHouseId + '.chat-message-sent-by-chef';\n        const config = this.getStoredConfig();\n        return config.topics && config.topics.indexOf(topic) !== -1;\n      } catch (error) {\n        console.error('Error checking chat subscription:', error);\n        return false;\n      }\n    }\n    isUnsubscribedFromChat(inHouseId) {\n      try {\n        const topic = 'house.' + inHouseId + '.chat-message-sent-by-chef';\n        const config = this.getStoredConfig();\n        return config.unsubscribedTopics && config.unsubscribedTopics.indexOf(topic) !== -1;\n      } catch (error) {\n        console.error('Error checking chat unsubscription:', error);\n        return false;\n      }\n    }\n    subscribeToChat(userService, inHouseId) {\n      try {\n        if (!userService.isStudent()) return false;\n        const houseId = userService.user.bfg_house_id;\n        const suffix = 'chat-message-sent-by-chef';\n        const topic = 'house.' + houseId + '.' + suffix;\n        const config = this.getStoredConfig();\n        if (!config.topics) config.topics = [];\n        if (!config.unsubscribedTopics) config.unsubscribedTopics = [];\n        if (config.topics.indexOf(topic) !== -1) {\n          return false;\n        }\n        this.subscribeToTopic(topic).then(() => {\n          config.topics.push(topic);\n          config.unsubscribedTopics = config.unsubscribedTopics.filter(myTopic => myTopic !== topic);\n          localStorage.setItem('push-notification-config', JSON.stringify(config));\n        });\n        return true;\n      } catch (error) {\n        console.error('Error subscribing to chat:', error);\n        return false;\n      }\n    }\n    unsubscribeFromChat(userService, inHouseId) {\n      try {\n        if (!userService.isStudent()) return false;\n        const houseId = userService.user.bfg_house_id;\n        const suffix = 'chat-message-sent-by-chef';\n        const topic = 'house.' + houseId + '.' + suffix;\n        const config = this.getStoredConfig();\n        if (!config.topics) config.topics = [];\n        if (!config.unsubscribedTopics) config.unsubscribedTopics = [];\n        if (config.unsubscribedTopics.indexOf(topic) !== -1) {\n          return false;\n        }\n        this.unsubscribeFromTopic(topic).then(() => {\n          config.unsubscribedTopics.push(topic);\n          config.topics = config.topics.filter(myTopic => myTopic !== topic);\n          localStorage.setItem('push-notification-config', JSON.stringify(config));\n        });\n        return true;\n      } catch (error) {\n        console.error('Error unsubscribing from chat:', error);\n        return false;\n      }\n    }\n    static ɵfac = function BFGPushNotificationService_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || BFGPushNotificationService)(i0.ɵɵinject(i1.Platform));\n    };\n    static ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: BFGPushNotificationService,\n      factory: BFGPushNotificationService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n  return BFGPushNotificationService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}