{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/rutviks/OneDrive - infopercept.com/Desktop/New folder/best-fed-greeks-app-full-source/best-fed-greeks-app-full-source/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { HttpService } from './common/http.service';\nimport { MessageService } from './common/message.service';\nimport { Observable } from 'rxjs';\nimport moment from 'moment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./common/http.service\";\nimport * as i2 from \"./common/message.service\";\nexport let BFGMealPlanService = /*#__PURE__*/(() => {\n  class BFGMealPlanService {\n    http;\n    msg;\n    _mealPlanAvailabilityConfig;\n    _enable_meal_repeats = false;\n    constructor(http, msg) {\n      this.http = http;\n      this.msg = msg;\n    }\n    loadAvailableMealTypes(date) {\n      return new Observable(observer => {\n        if (!this._mealPlanAvailabilityConfig) {\n          this.loadMealAvailabilityConfig().subscribe(mealAvailabiltiyConfig => {\n            observer.next(this.getAvailableMealTypes(date));\n            observer.complete();\n          });\n        } else {\n          observer.next(this.getAvailableMealTypes(date));\n          observer.complete();\n        }\n        return () => {};\n      });\n    }\n    loadAvailableMealPlanOptionsFromDay(day) {\n      return new Observable(observer => {\n        if (!this._mealPlanAvailabilityConfig) {\n          this.loadMealAvailabilityConfig().subscribe(mealAvailabiltiyConfig => {\n            observer.next({\n              enable_meal_repeats: this._enable_meal_repeats,\n              options: this.getAvailableMealPlanOptions(day.toLowerCase())\n            });\n            observer.complete();\n          });\n        } else {\n          observer.next({\n            enable_meal_repeats: this._enable_meal_repeats,\n            options: this.getAvailableMealPlanOptions(day.toLowerCase())\n          });\n          observer.complete();\n        }\n        return () => {};\n      });\n    }\n    loadTimeSlotsForDate(date, mealType) {\n      var _this = this;\n      return new Observable(observer => {\n        this.http.post('bfg/meals/load-meal-plan-time-slots', {\n          date: date,\n          meal_type: mealType\n        }).subscribe(/*#__PURE__*/function () {\n          var _ref = _asyncToGenerator(function* (response) {\n            let timeSlots = response.time_slots;\n            if (!timeSlots || timeSlots.length == 0) {\n              yield _this.msg.showToast('Error', 'Unable to load time slots. If this persists please contact technical support');\n              yield _this.msg.hideLoader();\n              observer.error('No time slots found');\n              return;\n            }\n            observer.next(timeSlots);\n            observer.complete();\n          });\n          return function (_x) {\n            return _ref.apply(this, arguments);\n          };\n        }());\n        return () => {};\n      });\n    }\n    getAvailableMealTypes(date) {\n      let availableTypes = [],\n        dayOfWeek = moment(date).format('dddd').toLowerCase(),\n        dayOfWeekConfig = this._mealPlanAvailabilityConfig[dayOfWeek];\n      if (dayOfWeekConfig) {\n        availableTypes = Object.keys(dayOfWeekConfig);\n      }\n      return availableTypes;\n    }\n    getAvailableMealPlanOptions(dayOfWeek) {\n      let availableTypes = [],\n        availableOptions = [],\n        dayOfWeekConfig = this._mealPlanAvailabilityConfig[dayOfWeek];\n      if (dayOfWeekConfig) {\n        availableTypes = Object.keys(dayOfWeekConfig);\n        availableTypes.forEach(val => {\n          let config = dayOfWeekConfig[val];\n          if (config.require_signup) {\n            availableOptions.push({\n              meal_type: val,\n              display: \"I'll Be At \" + val,\n              late_plate: false,\n              time_slots_enabled: config.has_signup_slots,\n              can_bring_guest: config.can_bring_guest\n            });\n          }\n          if (config.has_late_plate) {\n            availableOptions.push({\n              meal_type: val,\n              display: \"Late Plate \" + val,\n              late_plate: true,\n              can_bring_guest: config.can_bring_guest\n            });\n          }\n        });\n      }\n      return availableOptions;\n    }\n    loadMealAvailabilityConfig() {\n      var _this2 = this;\n      return new Observable(observer => {\n        if (this._mealPlanAvailabilityConfig) {\n          observer.next({\n            enable_meal_repeats: this._enable_meal_repeats,\n            options: this._mealPlanAvailabilityConfig\n          });\n          observer.complete();\n        } else {\n          this.http.post('bfg/meals/load-meal-plan-availability', {}).subscribe(/*#__PURE__*/function () {\n            var _ref2 = _asyncToGenerator(function* (response) {\n              _this2._mealPlanAvailabilityConfig = response.meal_plan_availability_config;\n              _this2._enable_meal_repeats = response.enable_meal_repeats;\n              if (!_this2._mealPlanAvailabilityConfig) {\n                yield _this2.msg.showToast('Error', 'Unable to load meal plan availability. If this persists please contact technical support');\n                yield _this2.msg.hideLoader();\n                observer.error('No meal plan availability found');\n                return;\n              }\n              observer.next({\n                enable_meal_repeats: _this2._enable_meal_repeats,\n                options: _this2._mealPlanAvailabilityConfig\n              });\n              observer.complete();\n            });\n            return function (_x2) {\n              return _ref2.apply(this, arguments);\n            };\n          }());\n        }\n        return () => {};\n      });\n    }\n    static ɵfac = function BFGMealPlanService_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || BFGMealPlanService)(i0.ɵɵinject(i1.HttpService), i0.ɵɵinject(i2.MessageService));\n    };\n    static ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: BFGMealPlanService,\n      factory: BFGMealPlanService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n  return BFGMealPlanService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}